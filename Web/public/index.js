!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.w={},r(r.s=26)}([function(e,t){e.exports=require("path")},function(e,t){e.exports=require("winston")},function(e,t){e.exports=require("webpack")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("webpack-bundle-analyzer")},function(e,t,r){"use strict";var n=r(0).join;e.exports={output:{path:n(__dirname,"../public/assets"),publicPath:"/"},resolve:{extensions:[".js",".ts",".tsx"],modules:[n(__dirname,"../node_modules"),n(__dirname,"../src")]},module:{rules:[{test:/\.tsx?$/,use:{loader:"babel-loader",options:{babelrc:!1,presets:[["@babel/env",{targets:{node:"6.10"}}],"@babel/preset-react","@babel/preset-stage-2","@babel/preset-typescript"],plugins:["universal-import"]}}},{test:/\.js$/,use:{loader:"babel-loader",options:{babelrc:!1,presets:[["@babel/env",{targets:{browsers:"last 2 versions"}}],"@babel/react","@babel/preset-stage-2"],plugins:["universal-import"]}}}]}}},function(e,t){e.exports=require("webpack-merge")},function(e,t){e.exports=require("fs")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.WSMessage=void 0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(23)),o=r(1);class i{constructor(e,t){Object.defineProperty(this,"type",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"payload",{configurable:!0,enumerable:!0,writable:!0,value:void 0}),this.type=e,this.payload=t}toString(){return JSON.stringify({type:this.type,payload:this.payload})}}t.WSMessage=i;let s=new Map;var u={start:function(e){(0,o.log)("info","[WSS] WSS initializing");const t=new n.Server({server:e});(0,o.log)("info","[WSS] WSS ready");t.on("connection",(e,t)=>{(0,o.log)("info","[WSS] WS connection created"),e.on("message",t=>{let r=JSON.parse(t),n=new i(r.type,r.payload);n.type,s.has(n.type)?s.get(n.type)(n,e):(0,o.log)("warn","[WSS] no route for "+n.type+" exists")}),e.on("close",()=>{(0,o.log)("info","closed ws")})})},use:(e,t)=>{s.has(e)?(0,o.log)("warn","[WSS] cannot register because another route already exists: "+e):((0,o.log)("info","[WSS] registering route WS route: "+e),s.set(e,t))}};t.default=u},function(e,t){e.exports=require("./assets/app.server.js")},function(e,t){e.exports=require("./assets/stats.json")},function(e,t){e.exports=require("webpack-hot-server-middleware")},function(e,t){e.exports=require("webpack-hot-middleware")},function(e,t){e.exports=require("webpack-dev-middleware")},function(e,t,r){"use strict";var n=r(7).readdirSync,o=r(0).join;e.exports=n(o(__dirname,"../node_modules")).filter(function(e){return!/\.bin|react-universal-component|require-universal-module|webpack-flush-chunks/.test(e)}).reduce(function(e,t){return e[t]="commonjs ".concat(t),e},{})},function(e,t,r){"use strict";var n=r(6),o=r(2),i=r(5),s=r(0).join,u=r(14);r(4).BundleAnalyzerPlugin;e.exports=n(i,{mode:"development",name:"server",target:"node",externals:u,entry:[s(__dirname,"../src/server/index")],devtool:"inline-source-map",output:{filename:"app.server.js",libraryTarget:"commonjs2"},plugins:[new o.optimize.LimitChunkCountPlugin({maxChunks:1})]})},function(e,t){e.exports=require("extract-css-chunks-webpack-plugin")},function(e,t,r){"use strict";var n=r(6),o=r(2),i=r(5),s=r(0).join,u=(r(16),r(4).BundleAnalyzerPlugin);e.exports=n(i,{mode:"development",name:"client",target:"web",entry:["webpack-hot-middleware/client?path=/__webpack_hmr&timeout=20000&reload=false&quiet=false&noInfo=false",s(__dirname,"../src/client/index")],devtool:"inline-source-map",output:{filename:"[name].client.js",chunkFilename:"[name].js"},optimization:{},plugins:[new o.HashedModuleIdsPlugin,new o.HotModuleReplacementPlugin,new u({analyzerPort:8888})]})},function(e,t){e.exports=require("amqplib")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendToQueue=t.initializeConsumer=t.initializeConnection=void 0;var n=r(18),o=r(1);const i=process.env.RMQ?process.env.RMQ:"rabbitmq";let s=()=>new Promise((e,t)=>{(0,o.log)("info","[RMQ] initializing on host "+i),(0,n.connect)("amqp://"+i).then(t=>{e(t)}).catch(e=>{"ECONNREFUSED"===e.code?((0,o.log)("warn","rabbitmq server cannot be reached @ "+i+", trying again in 1s"),setTimeout(s,1e3)):((0,o.log)("error","rabbitmq connection error: "+e.code),t(e))})});t.initializeConnection=s;t.initializeConsumer=((e,t,r)=>{e.assertQueue(t,{durable:!1}),e.consume(t,r)});t.sendToQueue=((e,t)=>(e.assertQueue(t,{durable:!1}),r=>{e.sendToQueue(t,Buffer.from(r))}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(19)),o=s(r(8)),i=r(1);function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}t.default=(()=>n.initializeConnection().then(e=>{e.createChannel().then(e=>{let t=n.sendToQueue(e,"q_java"),r=0,s=new Map;o.default.use("TestCode",(e,n)=>{if(e.payload.questionID&&e.payload.code){let u={submissionID:r,questionID:e.payload.questionID,code:e.payload.code};(0,i.log)("info","received CodeSubmission from client: "+u.toString()),s.set(r,n),n.send(new o.WSMessage("CodeReceived","").toString()),t(JSON.stringify(u)),r++}else(0,i.log)("warn","recieved malformed a CodeSubmission from client")}),n.initializeConsumer(e,"q_results",t=>{const r=JSON.parse(t.content.toString());let n=Number(r.submissionID);if(s.has(n)){const e=new o.WSMessage("TestInfo",{questionID:r.questionID,testInfo:r.resultsData});s.get(n).send(e.toString()),s.delete(n)}else(0,i.log)("warn","desync in submission ID ["+r.submissionID+"]");e.ack(t)})})}).catch(e=>(0,i.log)("error",e)))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=u(r(3)),o=r(1),i=u(r(7)),s=u(r(0));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}const a=n.Router(),l=s.resolve(s.join("repository","repository.json"));console.log(s.resolve(""));const c=JSON.parse(i.readFileSync(l,"utf-8"));(0,o.log)("info","Repository initialized at repository"),a.get("/",function(){var e,t=(e=function*(e,t){return t.status(200).json(c)},function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function s(e,t){try{var r=i[e](t),s=r.value}catch(e){return void o(e)}r.done?n(s):Promise.resolve(s).then(u,a)}function u(e){s("next",e)}function a(e){s("throw",e)}u()})});return function(e,r){return t.apply(this,arguments)}}()),a.get("/:id",(e,t)=>{const r=s.join("repository","problemPrompts",e.params.id+".html");i.existsSync(r)?t.status(200).sendFile(s.resolve(r)):t.status(204).end()});var p=a;t.default=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(3)),o=s(r(21)),i=s(r(20));function s(e){return e&&e.__esModule?e:{default:e}}const u=n.Router();u.use("/r",o.default),(0,i.default)();var a=u;t.default=a},function(e,t){e.exports=require("ws")},function(e,t,r){"use strict";var n=a(r(3)),o=r(0),i=r(1),s=a(r(8)),u=a(r(22));function a(e){return e&&e.__esModule?e:{default:e}}let l,c;process.env.PORT?(l=Number.parseInt(process.env.PORT),(0,i.log)("info","starting server on port "+l)):((0,i.log)("info","no port provided, starting server on 80"),l=80),c="production".toUpperCase().includes("PROD"),(0,i.log)("info","NODE_ENV is production which evaluates isProduction to "+c);const p=(0,n.default)();(0,i.log)("info","Configuring express routes..."),p.use("/api",u.default),(0,i.log)("info",`Configuring server for environment: ${c?"production":"development"}...`),c?(e=>{const t=r(10),i=r(9).default,s=(0,o.join)(__dirname,"assets");e.use("/",n.default.static(s)),e.use(i({clientStats:t,outputPath:s})),e.set("views",(0,o.join)(__dirname,"views"))})(p):(e=>{const t=r(17),i=r(15),s=t.output.publicPath,u=t.output.path,a=r(2)([t,i]),l=a.compilers[0];e.use(r(13)(a,{publicPath:s})),e.use(r(12)(l)),e.use(s,n.default.static(u)),e.use(r(11)(a,{serverRendererOptions:{outputPath:u}})),e.set("views",(0,o.join)(__dirname,"../public/views"))})(p),(0,i.log)("info","Configuring server engine..."),p.set("view engine","ejs"),p.set("port",l);let d=p.listen(p.get("port"),()=>{(0,i.log)("info",`Server listening on port ${p.get("port")}...`),s.default.start(d)})},function(e,t){e.exports=require("babel-polyfill")},function(e,t,r){r(25),e.exports=r(24)}]);